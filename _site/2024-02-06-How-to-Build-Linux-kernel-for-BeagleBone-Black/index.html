<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 6.0.1 | Copyright Dean Attali 2023 -->



<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  

  <title>How to Build Linux kernel for BeagleBone Black | Eric Lin</title>

  
  
  <meta name="author" content="Eric Lin">
  

  <meta name="description" content="In this tutorial, we’ll walk you through the process of building a custom Linux kernel tailored specifically for the BeagleBone Black platform. By following these steps, you’ll be able to create a customized embedded Linux distribution optimized for your project’s requirements. Pre-requisite Host Machine Environment $ uname -a Linux elinlinux...">

  

  

  
  <link rel="alternate" type="application/rss+xml" title="Eric Lin" href="http://localhost:4000/feed.xml">
  

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Eric Lin">
  <meta property="og:title" content="How to Build Linux kernel for BeagleBone Black | Eric Lin">
  <meta property="og:description" content="In this tutorial, we’ll walk you through the process of building a custom Linux kernel tailored specifically for the BeagleBone Black platform. By following these steps, you’ll be able to create a customized embedded Linux distribution optimized for your project’s requirements. Pre-requisite Host Machine Environment $ uname -a Linux elinlinux...">

  
  <meta property="og:image" content="http://localhost:4000/assets/img/eric.jpeg">
  

  
  <meta property="og:type" content="article">
  
  <meta property="og:article:author" content="Eric Lin">
  
  <meta property="og:article:published_time" content="2024-02-06T00:00:00-05:00">
  <meta property="og:url" content="http://localhost:4000/2024-02-06-How-to-Build-Linux-kernel-for-BeagleBone-Black/">
  <link rel="canonical" href="http://localhost:4000/2024-02-06-How-to-Build-Linux-kernel-for-BeagleBone-Black/">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@">
  <meta name="twitter:creator" content="@">

  <meta property="twitter:title" content="How to Build Linux kernel for BeagleBone Black | Eric Lin">
  <meta property="twitter:description" content="In this tutorial, we’ll walk you through the process of building a custom Linux kernel tailored specifically for the BeagleBone Black platform. By following these steps, you’ll be able to create a customized embedded Linux distribution optimized for your project’s requirements. Pre-requisite Host Machine Environment $ uname -a Linux elinlinux...">

  
  <meta name="twitter:image" content="http://localhost:4000/assets/img/eric.jpeg">
  

  


  

  
  

  

</head>


<body>
  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="http://localhost:4000/">Eric Lin</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/">Blog</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/aboutme">About Me</a>
          </li>
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  
    <div class="avatar-container">
      <div class="avatar-img-border">
        <a href="http://localhost:4000/">
          <img alt="Navigation bar avatar" class="avatar-img" src="/assets/img/eric.jpeg" />
        </a>
      </div>
    </div>
  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "Build Linux Distribution for NXP i.MX 8 with Yocto Project", \
          "desc"     : "Build Linux Distribution for NXP i.MX 8 with Yocto Project", \
          "category" : "", \
          "url"      : "/2024-02-26-Build-Linux-Distribution-for-NXP-iMX-8-with-Yocto-Project/", \
          "date"     : "February 26, 2024" \
        }, \
       \
        { \
          "title"    : "How to Build Linux kernel for BeagleBone Black", \
          "desc"     : "How to Build Linux kernel for BeagleBone Black", \
          "category" : "", \
          "url"      : "/2024-02-06-How-to-Build-Linux-kernel-for-BeagleBone-Black/", \
          "date"     : "February  6, 2024" \
        }, \
       \
        { \
          "title"    : "Leetcode 1. Two sum solution", \
          "desc"     : "Leetcode 1. Two sum solution", \
          "category" : "", \
          "url"      : "/2023-11-23-Leetcode-1.-Two-sum-solution/", \
          "date"     : "November 23, 2023" \
        }, \
       \
       \
        { \
          "title"    : "About me", \
          "desc"     : "About me", \
          "category" : "page", \
          "url"      : "/aboutme/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Hi, I&#39;m Eric", \
          "desc"     : "Hi, I&#39;m Eric", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "desc"     : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  



<header class="header-section ">
<div class="intro-header ">
  
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>How to Build Linux kernel for BeagleBone Black</h1>
          
          
           
            
            <span class="post-meta">Posted on February 6, 2024</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
  
  
</div>



</header>


<main class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <div class="blog-post">
        <p>In this tutorial, we’ll walk you through the process of building a custom Linux kernel tailored specifically for the BeagleBone Black platform. By following these steps, you’ll be able to create a customized embedded Linux distribution optimized for your project’s requirements.</p>

<h2 id="pre-requisite">Pre-requisite</h2>

<p><strong>Host Machine Environment</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ uname -a
Linux elinlinux 5.4.0-169-generic #187-Ubuntu SMP Thu Nov 23 14:53:38 UTC 2023 aarch64 aarch64 aarch64 GNU/Linux
</code></pre></div></div>

<p><strong>Target Machine Environment</strong></p>

<ul>
  <li>Board: BeagleBone Black</li>
  <li>processor: Sitara XAM3359AZCZ100 Cortex A8 ARM</li>
</ul>

<h3 id="ftdi-usb-to-serial-cable">FTDI USB to Serial cable</h3>

<p><img src="https://hackmd.io/_uploads/H1L74Xysp.png" alt="build_kernel_result" /></p>

<p>Which can be found at: <a href="http://www.ftdichip.com/Support/Documents/DataSheets/Cables/DS_TTL-232R_CABLES.pdf">http://www.ftdichip.com/Support/Documents/DataSheets/Cables/DS_TTL-232R_CABLES.pdf</a></p>

<h2 id="toolchain">Toolchain</h2>

<h3 id="create-workspace">Create workspace</h3>

<p>Create a working area to place the tools and components of the system.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~
<span class="nb">mkdir </span>beaglebone_workspace
<span class="nb">cd </span>beaglebone_workspace
</code></pre></div></div>

<h3 id="install-require-packages">Install require packages</h3>

<p>Make sure that your host machine is up to date and install the essential tools, and other tools required for cross compilation.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get upgrade
<span class="nb">sudo </span>apt-get <span class="nb">install </span>build-essential
<span class="nb">sudo </span>apt-get <span class="nb">install </span>flex bison
<span class="nb">sudo </span>apt-get <span class="nb">install </span>lzop 
<span class="nb">sudo </span>apt-get <span class="nb">install </span>u-boot-tools
</code></pre></div></div>

<p><strong>GCC Cross Compiler</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>gcc-arm-linux-gnueabihf
</code></pre></div></div>

<p><strong>GCC libc source</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>arm-toolchain
<span class="nb">cd </span>arm-toolchain
wget <span class="nt">-c</span> https://releases.linaro.org/components/toolchain/binaries/latest-7/arm-linux-gnueabihf/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf.tar.xz
<span class="nb">tar </span>xf gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf.tar.xz
</code></pre></div></div>

<p><strong>Partition Manager</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>gparted
</code></pre></div></div>

<h1 id="bootloader-u-boot">BootLoader (U-boot)</h1>

<blockquote>
  <p>Das U-boot source: <a href="https://github.com/u-boot/u-boot">https://github.com/u-boot/u-boot</a></p>
</blockquote>

<h3 id="download-u-boot-u-boot-202310">Download u-boot (u-boot-2023.10)</h3>

<blockquote>
  <p>Choose a u-boot version to download.</p>
</blockquote>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">wget -c https</span><span class="o">:</span><span class="nf">//github.com/u-boot/u-boot/archive/refs/tags/v2023.10.tar.gz</span>
</code></pre></div></div>

<h3 id="configure-u-boot">Configure U-Boot</h3>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">make</span> <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- am335x_boneblack_vboot_defconfig
</code></pre></div></div>

<h3 id="compile-u-boot">Compile U-boot</h3>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">make</span> <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- <span class="nt">-j4</span>
</code></pre></div></div>

<blockquote>
  <p>Refer <a href="https://docs.u-boot.org/en/latest/build/gcc.html">U-Boot: Building with GCC</a> for more information.</p>
</blockquote>

<h3 id="mlo-and-u-bootimg"><code class="language-plaintext highlighter-rouge">MLO</code> and <code class="language-plaintext highlighter-rouge">u-boot.img</code></h3>

<p>After the <code class="language-plaintext highlighter-rouge">BootLoader</code> has been compiled, run the <code class="language-plaintext highlighter-rouge">ls</code> command to make sure that you have the executables <code class="language-plaintext highlighter-rouge">MLO</code> and <code class="language-plaintext highlighter-rouge">u-boot.img</code>. The <code class="language-plaintext highlighter-rouge">MLO</code> file is the <strong>first stage BootLoader</strong>, and <code class="language-plaintext highlighter-rouge">u-boot.img</code> is the <strong>second stage BootLoader</strong> also known as the <strong>Bootstrap Loader</strong>.</p>

<h2 id="configurelinux-kernelforbeaglebone-black">Configure <code class="language-plaintext highlighter-rouge">Linux Kernel</code> for <code class="language-plaintext highlighter-rouge">BeagleBone Black</code></h2>

<blockquote>
  <p>Beaglebone Linux Kernel source: <a href="https://github.com/beagleboard/linux">https://github.com/beagleboard/linux</a></p>
</blockquote>

<h3 id="download-linux-kernel">Download Linux kernel</h3>
<blockquote>
  <p>Choose a linux kernel version on your demand.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget <span class="nt">-c</span> https://github.com/beagleboard/linux/archive/refs/tags/5.10.168-ti-r76.tar.gz
<span class="nb">tar</span> <span class="nt">-xvf</span> 5.10.168-ti-r76.tar.gz
</code></pre></div></div>

<h3 id="kernel-configuration-for-beaglebone-black">Kernel Configuration for BeagleBone Black</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- bb.org_defconfig
</code></pre></div></div>

<h3 id="build-the-kernel">Build the Kernel</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- uImage dtbs <span class="nv">LOADADDR</span><span class="o">=</span>0x80008000 <span class="nt">-j4</span>
</code></pre></div></div>

<h3 id="result">Result</h3>
<p><img src="https://hackmd.io/_uploads/Bk98QQkjT.png" alt="build_kernel_result" /></p>

<h3 id="build-modules">Build modules</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- <span class="nt">-j4</span> modules
</code></pre></div></div>

<blockquote>
  <p>Refer <a href="https://github.com/beagleboard/linux/tree/v5.19/Documentation/admin-guide">admin-guide</a> for more information.</p>

</blockquote>

<h1 id="preparing-the-microsd-card">Preparing the MicroSD Card</h1>

<h3 id="create-two-partitions">Create two partitions</h3>

<blockquote>
  <p>One partition for booting the kernel, and another one for the <code class="language-plaintext highlighter-rouge">Root File System</code>.</p>
</blockquote>

<ul>
  <li>Use <code class="language-plaintext highlighter-rouge">gparted</code> for partitioning.</li>
  <li>Create a new partition with 50 MiB for the size. Change the file system type to fat32 and label it boot.</li>
  <li>Add a second partition with 1000 MiB for the size, label it rootfs, and make sure that the file type is ext4.</li>
</ul>

<p><img src="https://hackmd.io/_uploads/HJ5CzQyoT.png" alt="partition" /></p>

<h1 id="root-file-system">Root File System</h1>

<h3 id="download-busybox">Download Busybox</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/beaglebone_workspace
wget <span class="nt">-c</span> https://github.com/mirror/busybox/archive/refs/tags/1_36_0.tar.gz
<span class="nb">tar</span> <span class="nt">-xvf</span> 1_36_0.tar.gz
</code></pre></div></div>

<h3 id="configure-busybox">Configure BusyBox</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>busybox-1_36_0
make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- defconfig
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- menuconfig
</code></pre></div></div>

<h3 id="enable-build-static-binary-no-shared-libs-option">Enable Build static binary (no shared libs) option</h3>

<p><img src="https://hackmd.io/_uploads/BkR0-QJop.png" alt="menuconfig" /></p>

<h3 id="build-busybox">Build BusyBox</h3>

<p>Install Busybox into the rootfs partition of your SD card</p>

<blockquote>
  <p>The build automatically generates a file “busybox.links”, which is used by ‘make install’ to create symlinks to the BusyBox binary for all compiled in commands.  This uses the CONFIG_PREFIX environment variable to specify where to install, and installs hardlinks or symlinks depending on the configuration preferences.  (You can also manually run the install script at “applets/install.sh”).</p>

</blockquote>

<blockquote>
  <p>Refer <a href="https://github.com/mirror/busybox/blob/master/README">busybox: readme</a> for more information.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- <span class="nv">CONFIG_PREFIX</span><span class="o">=</span>/media/&lt;username&gt;/rootfs/ <span class="nb">install</span>
</code></pre></div></div>

<h3 id="create-required-directories-and-files">Create required directories and files</h3>

<p>create directories and files required by the <code class="language-plaintext highlighter-rouge">Linux Kernel</code> to boot the system</p>

<h3 id="dev">dev/</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>dev
<span class="nb">sudo mknod </span>dev/console c 5 1
<span class="nb">sudo mknod </span>dev/null c 1 3
<span class="nb">sudo mknod </span>dev/zero c 1 5
</code></pre></div></div>

<h3 id="lib-and-usrlib">lib/ and usr/lib/</h3>

<p>Copy the libraries from the arm toolchain into the root file system lib.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp</span> <span class="nt">-r</span> ~/beaglebone_workspace/arm-toolchain/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf/arm-linux-gnueabihf/libc/lib/<span class="k">*</span> ./lib/
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp</span> <span class="nt">-r</span> ~/beaglebone_workspace/arm-toolchain/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabihf/arm-linux-gnueabihf/libc/lib/<span class="k">*</span> ./lib/
</code></pre></div></div>

<p>Create additional directories for mounting virtual file systems.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mkdir </span>proc sys root
</code></pre></div></div>

<h3 id="etc">etc/</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mkdir </span>etc etc/init.d
</code></pre></div></div>

<h3 id="etcinittab">etc/inittab</h3>

<p>After the kernel boots, it spawns the first user process, called the <code class="language-plaintext highlighter-rouge">init</code>. <code class="language-plaintext highlighter-rouge">init</code> is a background process that runs unitil the system is shut down. This process requires a configuration file called <code class="language-plaintext highlighter-rouge">etc/inittab</code>, which contains actions the system needs to perform at a given runlevel.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vi etc/inittab
</code></pre></div></div>

<p>Copy the following into the <code class="language-plaintext highlighter-rouge">etc/inittab</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>::sysinit:/etc/init.d/rcS
::respawn:-/bin/sh
::askfirst:-/bin/sh
</code></pre></div></div>
<blockquote>
  <p>For more setting options, please refer <a href="https://www.ibm.com/docs/en/aix/7.1?topic=files-inittab-file">IBM: inittab File</a>.</p>
</blockquote>

<h3 id="etcfstab">etc/fstab</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi etc/fstab
</code></pre></div></div>

<p>Copy the following into <code class="language-plaintext highlighter-rouge">etc/fstab</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>proc    /proc    proc   defaults  0 0
sysfs   /sys     sysfs  defaults  0 0
</code></pre></div></div>
<blockquote>
  <p>For more setting options, please refer <a href="https://man7.org/linux/man-pages/man5/fstab.5.html">man: fstab</a>.</p>
</blockquote>

<h3 id="etchostname-and-etcpasswd">etc/hostname and etc/passwd</h3>

<p>Write hostname into it.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vi etc/hostname
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vi etc/passwd 
</code></pre></div></div>

<p>Copy <code class="language-plaintext highlighter-rouge">root::0:0:root:/root:/bin/sh</code>  into it.</p>

<h3 id="initdrcs">init.d/rcS</h3>

<p>Create the file <code class="language-plaintext highlighter-rouge">init.d/rcS</code> to setup the system.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vi etc/init.d/rcS
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>
<span class="c">#   ---------------------------------------------</span>
<span class="c">#   Common settings</span>
<span class="c">#   ---------------------------------------------</span>
<span class="c"># Replace &lt;YOUR_HOSTNAME&gt; with your hostname!</span>
<span class="nv">HOSTNAME</span><span class="o">=</span>&lt;YOUR_HOSTNAME&gt;
<span class="nv">VERSION</span><span class="o">=</span>1.0.0

<span class="nb">hostname</span> <span class="nv">$HOSTNAME</span>

<span class="c">#   ---------------------------------------------</span>
<span class="c">#   Prints execution status.</span>
<span class="c">#</span>
<span class="c">#   arg1 : Execution status</span>
<span class="c">#   arg2 : Continue (0) or Abort (1) on error</span>
<span class="c">#   ---------------------------------------------</span>
status <span class="o">()</span>
<span class="o">{</span>
       <span class="k">if</span> <span class="o">[</span> <span class="nv">$1</span> <span class="nt">-eq</span> 0 <span class="o">]</span> <span class="p">;</span> <span class="k">then
               </span><span class="nb">echo</span> <span class="s2">"[SUCCESS]"</span>
       <span class="k">else
               </span><span class="nb">echo</span> <span class="s2">"[FAILED]"</span>

               <span class="k">if</span> <span class="o">[</span> <span class="nv">$2</span> <span class="nt">-eq</span> 1 <span class="o">]</span> <span class="p">;</span> <span class="k">then
                       </span><span class="nb">echo</span> <span class="s2">"... System init aborted."</span>
                       <span class="nb">exit </span>1
               <span class="k">fi
       fi</span>
<span class="o">}</span>

<span class="c">#   ---------------------------------------------</span>
<span class="c">#   Get verbose</span>
<span class="c">#   ---------------------------------------------</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"    System initialization..."</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"    Hostname       : </span><span class="nv">$HOSTNAME</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"    Filesystem     : v</span><span class="nv">$VERSION</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"    Kernel release : </span><span class="sb">`</span><span class="nb">uname</span> <span class="nt">-s</span><span class="sb">`</span><span class="s2"> </span><span class="sb">`</span><span class="nb">uname</span> <span class="nt">-r</span><span class="sb">`</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"    Kernel version : </span><span class="sb">`</span><span class="nb">uname</span> <span class="nt">-v</span><span class="sb">`</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">""</span>

<span class="c">#   ---------------------------------------------</span>
<span class="c">#   MDEV Support</span>
<span class="c">#   (Requires sysfs support in the kernel)</span>
<span class="c">#   ---------------------------------------------</span>
<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Mounting /proc             : "</span>
mount <span class="nt">-n</span> <span class="nt">-t</span> proc /proc /proc
status <span class="nv">$?</span> 1

<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Mounting /sys              : "</span>
mount <span class="nt">-n</span> <span class="nt">-t</span> sysfs sysfs /sys
status <span class="nv">$?</span> 1

<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Mounting /dev              : "</span>
mount <span class="nt">-n</span> <span class="nt">-t</span> tmpfs mdev /dev
status <span class="nv">$?</span> 1

<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Mounting /dev/pts          : "</span>
<span class="nb">mkdir</span> /dev/pts
mount <span class="nt">-t</span> devpts devpts /dev/pts
status <span class="nv">$?</span> 1

<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Enabling hot-plug          : "</span>
<span class="nb">echo</span> <span class="s2">"/sbin/mdev"</span> <span class="o">&gt;</span> /proc/sys/kernel/hotplug
status <span class="nv">$?</span> 0

<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Populating /dev            : "</span>
<span class="nb">mkdir</span> /dev/input
<span class="nb">mkdir</span> /dev/snd

mdev <span class="nt">-s</span>
status <span class="nv">$?</span> 0

<span class="c">#   ---------------------------------------------</span>
<span class="c">#   Mount the default file systems</span>
<span class="c">#   ---------------------------------------------</span>
<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Mounting other filesystems : "</span>
mount <span class="nt">-a</span>
status <span class="nv">$?</span> 0

<span class="c">#   ---------------------------------------------</span>
<span class="c">#   Set PATH</span>
<span class="c">#   ---------------------------------------------</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin

<span class="c">#   ---------------------------------------------</span>
<span class="c">#   Start other daemons</span>
<span class="c">#   ---------------------------------------------</span>
<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Starting syslogd           : "</span>
/sbin/syslogd
status <span class="nv">$?</span> 0

<span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">" Starting telnetd           : "</span>
/usr/sbin/telnetd
status <span class="nv">$?</span> 0

<span class="c">#   ---------------------------------------------</span>
<span class="c">#   Done!</span>
<span class="c">#   ---------------------------------------------</span>
<span class="nb">echo</span> <span class="s2">""</span>
<span class="nb">echo</span> <span class="s2">"System initialization complete."</span>
</code></pre></div></div>

<h3 id="build-directory-for-the-kernel">Build directory for the kernel</h3>

<p>After creating the above files and directories, install the kernel modules into the <code class="language-plaintext highlighter-rouge">Root File System</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/beaglebone_workspace/linux-5.10.168-ti-r76
make <span class="nv">ARCH</span><span class="o">=</span>arm <span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-gnueabihf- <span class="nv">CONFIG_PREFIX</span><span class="o">=</span>/media/&lt;username&gt;/rootfs/ modules_install
</code></pre></div></div>
<blockquote>
  <p>Refer <a href="https://github.com/beagleboard/linux/tree/v5.19/Documentation/admin-guide#build-directory-for-the-kernel">admin-guide: build-directory-for-the-kernel</a> for more information.</p>
</blockquote>

<h1 id="boot-partition">Boot Partition</h1>

<p>Create a boot folder in your workspace directory and copy <code class="language-plaintext highlighter-rouge">MLO</code>, <code class="language-plaintext highlighter-rouge">u-boot.img</code>, <code class="language-plaintext highlighter-rouge">uImage</code>, and <code class="language-plaintext highlighter-rouge">am335x-boneblack.dbt</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/beaglebone_workspace/
<span class="nb">mkdir </span>boot
<span class="nb">cp </span>u-boot-2023.10/MLO boot/
<span class="nb">cp </span>u-boot-2023.10/u-boot.img boot/
<span class="nb">cp </span>linux-5.10.168-ti-r76/arch/arm/boot/uImage boot/
<span class="nb">cp </span>linux-5.10.168-ti-r76/arch/arm/boot/dts/am335x-boneblack.dtb boot/
</code></pre></div></div>

<h3 id="uenvtxt">uEnv.txt</h3>

<p>Go into the <code class="language-plaintext highlighter-rouge">boot</code> folder and create a file called <code class="language-plaintext highlighter-rouge">uEnv.txt</code>. This file will tell the <code class="language-plaintext highlighter-rouge">BootLoader</code> where to load the kernel image and the device binary tree.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi boot/nEnv.txt
</code></pre></div></div>

<p>Copy the following into <code class="language-plaintext highlighter-rouge">uEnv.txt</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">uenv_addr</span><span class="o">=</span>0x81000000
<span class="nv">load_addr</span><span class="o">=</span>0x82000000
<span class="nv">dtb_addr</span><span class="o">=</span>0x88000000
<span class="nv">mmc_args</span><span class="o">=</span>setenv bootargs <span class="nv">console</span><span class="o">=</span>ttyO0,115200n8 noinitrd <span class="nv">root</span><span class="o">=</span>/dev/mmcblk0p2 rw <span class="nv">rootfstype</span><span class="o">=</span>ext4 rootwait
<span class="nv">sdboot</span><span class="o">=</span><span class="nb">echo </span>Booting from SD Card ...<span class="p">;</span>mmc rescan<span class="p">;</span>fatload mmc 0:1 <span class="k">${</span><span class="nv">uenv_addr</span><span class="k">}</span> uEnv.txt<span class="p">;</span><span class="nb">env </span>import <span class="nt">-t</span> <span class="k">${</span><span class="nv">uenv_addr</span><span class="k">}</span> <span class="nv">$filesize</span><span class="p">;</span>fatload mmc 0:1 <span class="k">${</span><span class="nv">load_addr</span><span class="k">}</span> uImage<span class="p">;</span>fatload mmc 0:1 <span class="k">${</span><span class="nv">dtb_addr</span><span class="k">}</span> am335x-boneblack.dtb<span class="p">;</span>run mmc_args<span class="p">;</span>bootm <span class="k">${</span><span class="nv">load_addr</span><span class="k">}</span> - <span class="k">${</span><span class="nv">dtb_addr</span><span class="k">}</span> 
<span class="nv">uenvcmd</span><span class="o">=</span>run sdboot
</code></pre></div></div>

<p><strong>Important:</strong> Leave a newline at the end of the <code class="language-plaintext highlighter-rouge">uEnv.txt</code> file.</p>

<p>Finally, copy everything from the <code class="language-plaintext highlighter-rouge">~/beaglebone_workspace/boot</code> directory to the <code class="language-plaintext highlighter-rouge">BOOT</code> partition of your SD card.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/beaglebone_workspace/boot/
<span class="nb">sudo cp</span> <span class="k">*</span> /media/&lt;username&gt;/BOOT/
<span class="nb">sync</span>
</code></pre></div></div>

<h1 id="connect-ftdi-cable-with-the-board">Connect FTDI cable with the board</h1>

<p>Connect FTDI cable with J1 serial header on the board.
<img src="https://hackmd.io/_uploads/B1zStzkia.png" alt="J1" /></p>

<blockquote>
  <p>For more information, refer <a href="https://github.com/beagleboard/beaglebone-black/blob/master/BBB_SRM.pdf">BBB_SRM: 7.5 Serial Header</a>.</p>
</blockquote>

<h1 id="boot-result">Boot result</h1>

<p>After you boot up the board, the system should mount the root file system successfully and you should automatically be logged in as root <code class="language-plaintext highlighter-rouge">#</code>.</p>

<p><img src="https://hackmd.io/_uploads/B1UOuz1jT.png" alt="boot_result" /></p>

<h1 id="reference">Reference</h1>

<ul>
  <li><a href="https://buildelinux.readthedocs.io/en/latest/embedded_systems/linux_distribution/linux_distro/">How to Build a Linux Distribution for the BeagleBone Black</a></li>
</ul>

      </div>

      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=How+to+Build+Linux+kernel+for+BeagleBone+Black&url=http%3A%2F%2Flocalhost%3A4000%2F2024-02-06-How-to-Build-Linux-kernel-for-BeagleBone-Black%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2024-02-06-How-to-Build-Linux-kernel-for-BeagleBone-Black%2F"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2024-02-06-How-to-Build-Linux-kernel-for-BeagleBone-Black%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/2023-11-23-Leetcode-1.-Two-sum-solution/" data-toggle="tooltip" data-placement="top" title="Leetcode 1. Two sum solution">
            <i class="fas fa-arrow-left" alt="Previous Post"></i>
            <span class="d-none d-sm-inline-block">Previous Post</span>
          </a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/2024-02-26-Build-Linux-Distribution-for-NXP-iMX-8-with-Yocto-Project/" data-toggle="tooltip" data-placement="top" title="Build Linux Distribution for NXP i.MX 8 with Yocto Project">
            <span class="d-none d-sm-inline-block">Next Post</span>
            <i class="fas fa-arrow-right" alt="Next Post"></i>
          </a>
        </li>
        
      </ul>
      
  
  
  

  


  

  



    </div>
  </div>
</main>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      
<ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="mailto:ericlinsechs@gmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/ericlinsechs" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/eric-lin-a8a187248" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Eric Lin
        &nbsp;&bull;&nbsp;
      
      2024

      

      

      

      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
